<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">

<script class="next-config" data-name="main" type="application/json">{&quot;hostname&quot;:&quot;tzxhy.github.io&quot;,&quot;root&quot;:&quot;&#x2F;&quot;,&quot;images&quot;:&quot;&#x2F;images&quot;,&quot;scheme&quot;:&quot;Mist&quot;,&quot;version&quot;:&quot;8.4.0&quot;,&quot;exturl&quot;:false,&quot;sidebar&quot;:{&quot;position&quot;:&quot;left&quot;,&quot;display&quot;:&quot;post&quot;,&quot;padding&quot;:18,&quot;offset&quot;:12,&quot;b2t&quot;:false,&quot;scrollpercent&quot;:false,&quot;onmobile&quot;:false},&quot;copycode&quot;:false,&quot;bookmark&quot;:{&quot;enable&quot;:false,&quot;color&quot;:&quot;#222&quot;,&quot;save&quot;:&quot;auto&quot;},&quot;fancybox&quot;:true,&quot;mediumzoom&quot;:false,&quot;lazyload&quot;:false,&quot;pangu&quot;:false,&quot;comments&quot;:{&quot;style&quot;:&quot;tabs&quot;,&quot;active&quot;:null,&quot;storage&quot;:true,&quot;lazyload&quot;:false,&quot;nav&quot;:null},&quot;motion&quot;:{&quot;enable&quot;:false,&quot;async&quot;:false,&quot;transition&quot;:{&quot;post_block&quot;:&quot;fadeIn&quot;,&quot;post_header&quot;:&quot;slideDownIn&quot;,&quot;post_body&quot;:&quot;slideDownIn&quot;,&quot;coll_header&quot;:&quot;slideLeftIn&quot;,&quot;sidebar&quot;:&quot;slideUpIn&quot;}},&quot;prism&quot;:false,&quot;i18n&quot;:{&quot;placeholder&quot;:&quot;Searching...&quot;,&quot;empty&quot;:&quot;We didn&#39;t find any results for the search: ${query}&quot;,&quot;hits_time&quot;:&quot;${hits} results found in ${time} ms&quot;,&quot;hits&quot;:&quot;${hits} results found&quot;}}</script>
<meta name="description" content="GlobalsqueueMicrotask(callback)v11新增的API。用于将callback加入到当前phase的microtask队列里。需要注意的是：process.nextTick在Nodejs的每次循环每个phase中总是会比microtask queue优先执行 TextDecoder&#x2F;TextEncoder文本的编码、解码 URL&#x2F;URLSearchParamsWHATW">
<meta property="og:type" content="article">
<meta property="og:title" content="v11-10-nodejs学习-三">
<meta property="og:url" content="https://tzxhy.github.io/2019/03/14/v11-10-nodejs%E5%AD%A6%E4%B9%A0-%E4%B8%89/index.html">
<meta property="og:site_name" content="CMeUp">
<meta property="og:description" content="GlobalsqueueMicrotask(callback)v11新增的API。用于将callback加入到当前phase的microtask队列里。需要注意的是：process.nextTick在Nodejs的每次循环每个phase中总是会比microtask queue优先执行 TextDecoder&#x2F;TextEncoder文本的编码、解码 URL&#x2F;URLSearchParamsWHATW">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2019-03-14T14:50:13.000Z">
<meta property="article:modified_time" content="2021-05-24T09:30:32.420Z">
<meta property="article:author" content="谭智轩">
<meta property="article:tag" content="Nodejs">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://tzxhy.github.io/2019/03/14/v11-10-nodejs%E5%AD%A6%E4%B9%A0-%E4%B8%89/">



<script class="next-config" data-name="page" type="application/json">{&quot;sidebar&quot;:&quot;&quot;,&quot;isHome&quot;:false,&quot;isPost&quot;:true,&quot;lang&quot;:&quot;en&quot;,&quot;comments&quot;:true,&quot;permalink&quot;:&quot;https:&#x2F;&#x2F;tzxhy.github.io&#x2F;2019&#x2F;03&#x2F;14&#x2F;v11-10-nodejs%E5%AD%A6%E4%B9%A0-%E4%B8%89&#x2F;&quot;,&quot;path&quot;:&quot;2019&#x2F;03&#x2F;14&#x2F;v11-10-nodejs学习-三&#x2F;&quot;,&quot;title&quot;:&quot;v11-10-nodejs学习-三&quot;}</script>

<script class="next-config" data-name="calendar" type="application/json">&quot;&quot;</script>
<title>v11-10-nodejs学习-三 | CMeUp</title><script src="/js/config.js"></script>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">CMeUp</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">记录一些学习心得，QQ:1139723651.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>Tags</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>Categories</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Globals"><span class="nav-number">1.</span> <span class="nav-text">Globals</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#queueMicrotask-callback"><span class="nav-number">1.0.1.</span> <span class="nav-text">queueMicrotask(callback)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TextDecoder-TextEncoder"><span class="nav-number">1.0.2.</span> <span class="nav-text">TextDecoder&#x2F;TextEncoder</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#URL-URLSearchParams"><span class="nav-number">1.0.3.</span> <span class="nav-text">URL&#x2F;URLSearchParams</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Inspector"><span class="nav-number">1.1.</span> <span class="nav-text">Inspector</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Modules"><span class="nav-number">1.2.</span> <span class="nav-text">Modules</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%93%E5%AD%98"><span class="nav-number">1.2.1.</span> <span class="nav-text">缓存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#require-main-module"><span class="nav-number">1.2.2.</span> <span class="nav-text">require.main &#x3D;&#x3D;&#x3D; module</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8"><span class="nav-number">1.2.3.</span> <span class="nav-text">循环引用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dirname-filename"><span class="nav-number">1.2.4.</span> <span class="nav-text">__dirname, __filename</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#exports-%E5%92%8C-module-exports"><span class="nav-number">1.2.5.</span> <span class="nav-text">exports 和 module.exports</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#require-cache"><span class="nav-number">1.2.6.</span> <span class="nav-text">require.cache</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#require-resolve-request-options"><span class="nav-number">1.2.7.</span> <span class="nav-text">require.resolve(request[, options])</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#require-resolve-paths-request"><span class="nav-number">1.2.8.</span> <span class="nav-text">require.resolve.paths(request)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Net"><span class="nav-number">1.3.</span> <span class="nav-text">Net</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Path"><span class="nav-number">1.4.</span> <span class="nav-text">Path</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Path-resolve"><span class="nav-number">1.4.1.</span> <span class="nav-text">Path.resolve</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Path-posix"><span class="nav-number">1.4.2.</span> <span class="nav-text">Path.posix</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#perf-hooks"><span class="nav-number">1.5.</span> <span class="nav-text">perf_hooks</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Process"><span class="nav-number">1.6.</span> <span class="nav-text">Process</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Process-Events"><span class="nav-number">1.6.1.</span> <span class="nav-text">Process Events</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A8uncaughtException%E4%BA%8B%E4%BB%B6"><span class="nav-number">1.6.1.1.</span> <span class="nav-text">正确使用uncaughtException事件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#process-exit"><span class="nav-number">1.6.2.</span> <span class="nav-text">process.exit()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#process-abort"><span class="nav-number">1.6.3.</span> <span class="nav-text">process.abort()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#process-allowedNodeEnvironmentFlags"><span class="nav-number">1.6.4.</span> <span class="nav-text">process.allowedNodeEnvironmentFlags</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#process-chdir-directory"><span class="nav-number">1.6.5.</span> <span class="nav-text">process.chdir(directory)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#process-stderr"><span class="nav-number">1.6.6.</span> <span class="nav-text">process.stderr</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#process-stdin"><span class="nav-number">1.6.7.</span> <span class="nav-text">process.stdin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#process-stdout"><span class="nav-number">1.6.8.</span> <span class="nav-text">process.stdout</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#process-stdout-and-process-stderr%E6%B3%A8%E6%84%8F%E7%82%B9"><span class="nav-number">1.6.9.</span> <span class="nav-text">process.stdout and process.stderr注意点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Stream"><span class="nav-number">1.7.</span> <span class="nav-text">Stream</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Trace-Events"><span class="nav-number">1.8.</span> <span class="nav-text">Trace Events</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TTY"><span class="nav-number">1.9.</span> <span class="nav-text">TTY</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#V8"><span class="nav-number">1.10.</span> <span class="nav-text">V8</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#v8-cachedDataVersionTag"><span class="nav-number">1.10.1.</span> <span class="nav-text">v8.cachedDataVersionTag()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#v8-getHeapSpaceStatistics"><span class="nav-number">1.10.2.</span> <span class="nav-text">v8.getHeapSpaceStatistics()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#v8-getHeapStatistics"><span class="nav-number">1.10.3.</span> <span class="nav-text">v8.getHeapStatistics()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#v8-setFlagsFromString-flags"><span class="nav-number">1.10.4.</span> <span class="nav-text">v8.setFlagsFromString(flags)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Serialization-API"><span class="nav-number">1.10.5.</span> <span class="nav-text">Serialization API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#v8-serialize-value"><span class="nav-number">1.10.5.1.</span> <span class="nav-text">v8.serialize(value)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#v8-deserialize-buffer"><span class="nav-number">1.10.5.2.</span> <span class="nav-text">v8.deserialize(buffer)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#v8-Serializer"><span class="nav-number">1.10.6.</span> <span class="nav-text">v8.Serializer</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#new-Serializer"><span class="nav-number">1.10.6.1.</span> <span class="nav-text">new Serializer()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#serializer-writeHeader"><span class="nav-number">1.10.6.2.</span> <span class="nav-text">serializer.writeHeader()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#serializer-writeValue-value"><span class="nav-number">1.10.6.3.</span> <span class="nav-text">serializer.writeValue(value)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#serializer-releaseBuffer"><span class="nav-number">1.10.6.4.</span> <span class="nav-text">serializer.releaseBuffer()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#serializer-transferArrayBuffer-id-arrayBuffer"><span class="nav-number">1.10.6.5.</span> <span class="nav-text">serializer.transferArrayBuffer(id, arrayBuffer)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#serializer-writeUint32-%E7%AD%89"><span class="nav-number">1.10.6.6.</span> <span class="nav-text">serializer.writeUint32 等</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#v8-Deserializer-%E7%95%A5"><span class="nav-number">1.10.7.</span> <span class="nav-text">v8.Deserializer 略</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#VM"><span class="nav-number">1.11.</span> <span class="nav-text">VM</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Class-vm-Script"><span class="nav-number">1.11.1.</span> <span class="nav-text">Class: vm.Script</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Constructor-new-vm-Script-code-options"><span class="nav-number">1.11.1.1.</span> <span class="nav-text">Constructor: new vm.Script(code[, options])</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#script-createCachedData"><span class="nav-number">1.11.1.2.</span> <span class="nav-text">script.createCachedData()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#script-runInContext-contextifiedSandbox-options"><span class="nav-number">1.11.1.3.</span> <span class="nav-text">script.runInContext(contextifiedSandbox[, options])</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#script-runInNewContext-sandbox-options"><span class="nav-number">1.11.1.4.</span> <span class="nav-text">script.runInNewContext([sandbox[, options]])</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#script-runInThisContext-options"><span class="nav-number">1.11.1.5.</span> <span class="nav-text">script.runInThisContext([options])</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Timer%E7%AD%89%E7%9B%B8%E5%85%B3"><span class="nav-number">1.11.1.6.</span> <span class="nav-text">Timer等相关</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Zlib"><span class="nav-number">1.12.</span> <span class="nav-text">Zlib</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Worker-Threads"><span class="nav-number">1.13.</span> <span class="nav-text">Worker Threads</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Worker-isMainThread"><span class="nav-number">1.13.1.</span> <span class="nav-text">Worker.isMainThread</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Worker-parentPort"><span class="nav-number">1.13.2.</span> <span class="nav-text">Worker.parentPort</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Worker-threadId"><span class="nav-number">1.13.3.</span> <span class="nav-text">Worker.threadId</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9C%81%E7%95%A5"><span class="nav-number">1.13.4.</span> <span class="nav-text">省略</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">谭智轩</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">81</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">30</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">81</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/tzxhy" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;tzxhy" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://juejin.cn/user/1820446984508072" title="掘金 → https:&#x2F;&#x2F;juejin.cn&#x2F;user&#x2F;1820446984508072" rel="noopener" target="_blank">掘金</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.yuque.com/tanzhixuan-zebzs" title="语雀 → https:&#x2F;&#x2F;www.yuque.com&#x2F;tanzhixuan-zebzs" rel="noopener" target="_blank">语雀</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://tzxhy.github.io/2019/03/14/v11-10-nodejs%E5%AD%A6%E4%B9%A0-%E4%B8%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="谭智轩">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CMeUp">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          v11-10-nodejs学习-三
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-03-14 14:50:13" itemprop="dateCreated datePublished" datetime="2019-03-14T14:50:13Z">2019-03-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Nodejs/" itemprop="url" rel="index"><span itemprop="name">Nodejs</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <span id="more"></span>
<h1 id="Globals"><a href="#Globals" class="headerlink" title="Globals"></a>Globals</h1><h3 id="queueMicrotask-callback"><a href="#queueMicrotask-callback" class="headerlink" title="queueMicrotask(callback)"></a>queueMicrotask(callback)</h3><p>v11新增的API。用于将callback加入到当前phase的microtask队列里。需要注意的是：<strong>process.nextTick在Nodejs的每次循环每个phase中总是会比microtask queue优先执行</strong></p>
<h3 id="TextDecoder-TextEncoder"><a href="#TextDecoder-TextEncoder" class="headerlink" title="TextDecoder/TextEncoder"></a>TextDecoder/TextEncoder</h3><p>文本的编码、解码</p>
<h3 id="URL-URLSearchParams"><a href="#URL-URLSearchParams" class="headerlink" title="URL/URLSearchParams"></a>URL/URLSearchParams</h3><p>WHATWG制定。下文应该会有相关介绍。</p>
<hr>
<h2 id="Inspector"><a href="#Inspector" class="headerlink" title="Inspector"></a>Inspector</h2><p>可通过Inspector与v8的Inspector交互</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> inspector = <span class="built_in">require</span>(<span class="string">&#x27;inspector&#x27;</span>);</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Modules"><a href="#Modules" class="headerlink" title="Modules"></a>Modules</h2><h3 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h3><p>默认下nodejs会对加载过的module进行缓存。但是，当操作系统为大小写不敏感（比如MacOS）时，require(‘A.js’);require(‘a.js’); 会导致缓存两次。同时，不同代码处的requre(‘a’)可能返回不一样的模块，具体参考nodejs的模块加载机制。</p>
<h3 id="require-main-module"><a href="#require-main-module" class="headerlink" title="require.main === module"></a>require.main === module</h3><p>可以用这个来判断当前文件是否是nodejs直接调用的文件。</p>
<h3 id="循环引用"><a href="#循环引用" class="headerlink" title="循环引用"></a>循环引用</h3><p>实际开发中很可能产生循环引用：a.js引用了b.js，b.js也引用了a.js。Nodejs的处理方式是产生循环引用时，先返回一个<strong>未完成的copy</strong>(这里是a.js)给调用者(这里是b.js)，等待调用者加载完毕，再回过来加载调用者。</p>
<h3 id="dirname-filename"><a href="#dirname-filename" class="headerlink" title="__dirname, __filename"></a>__dirname, __filename</h3><p>分别表示当前文件的目录和当前文件绝对路径</p>
<h3 id="exports-和-module-exports"><a href="#exports-和-module-exports" class="headerlink" title="exports 和 module.exports"></a>exports 和 module.exports</h3><p>exports就是module.exports对象的引用。导出时具体有什么区别就跟js中一样了。可以把exports理解成函数的参数。它能保持对原对象的引用。</p>
<h3 id="require-cache"><a href="#require-cache" class="headerlink" title="require.cache"></a>require.cache</h3><p>返回一个对象，键值对是文件模块引用的其他模块。可以删除某个键值对a，在下次require(‘a’)时会重新加载。</p>
<h3 id="require-resolve-request-options"><a href="#require-resolve-request-options" class="headerlink" title="require.resolve(request[, options])"></a>require.resolve(request[, options])</h3><p>返回找到的文件模块的path</p>
<h3 id="require-resolve-paths-request"><a href="#require-resolve-paths-request" class="headerlink" title="require.resolve.paths(request)"></a>require.resolve.paths(request)</h3><p>返回找到的所有文件模块的path</p>
<hr>
<h2 id="Net"><a href="#Net" class="headerlink" title="Net"></a>Net</h2><hr>
<h2 id="Path"><a href="#Path" class="headerlink" title="Path"></a>Path</h2><h3 id="Path-resolve"><a href="#Path-resolve" class="headerlink" title="Path.resolve"></a>Path.resolve</h3><p>如果首个参数不是绝对路径，那么会使用process.cwd()  （当前工作目录，就是启动node的目录）作为根路径。</p>
<h3 id="Path-posix"><a href="#Path-posix" class="headerlink" title="Path.posix"></a>Path.posix</h3><p>返回一个包含平台相关的path对象。比如想在Linux上拼凑windows平台的路径。</p>
<hr>
<h2 id="perf-hooks"><a href="#perf-hooks" class="headerlink" title="perf_hooks"></a>perf_hooks</h2><hr>
<h2 id="Process"><a href="#Process" class="headerlink" title="Process"></a>Process</h2><p>process 对象，能提供当前Nodejs进程信息以及控制当前进程。</p>
<h3 id="Process-Events"><a href="#Process-Events" class="headerlink" title="Process Events"></a>Process Events</h3><p>process 对象也是EventEmitter的对象。有：</p>
<ul>
<li>beforeExit</li>
<li>disconnect</li>
<li>exit</li>
<li>message</li>
<li>multipleResolves <strong>V10.12新增</strong> 当一个Promise被多次resolve或者reject或者在resolve后reject或者反过来。该回调为错误捕获。</li>
<li>rejectionHandled</li>
<li>uncaughtException</li>
<li>unhandledRejection</li>
<li>warning</li>
<li>Signal Events<h4 id="正确使用uncaughtException事件"><a href="#正确使用uncaughtException事件" class="headerlink" title="正确使用uncaughtException事件"></a>正确使用uncaughtException事件</h4>该事件在触发后，进程会退出。应该在该回调中执行一些资源的清理（比如打开的文件）以及记录相关崩溃信息，而不要妄图去修复进城，期待它会再次好起来。详见<a target="_blank" rel="noopener" href="https://nodejs.org/api/process.html">官网</a>关于<strong>Warning: Using <code>&#39;uncaughtException&#39;</code> correctly</strong>一节。<h3 id="process-exit"><a href="#process-exit" class="headerlink" title="process.exit()"></a>process.exit()</h3>会尽快退出进程，而不管是否还有其他异步回调等待完成。优雅的方式是使用process.exitCode。<h3 id="process-abort"><a href="#process-abort" class="headerlink" title="process.abort()"></a>process.abort()</h3>立即结束Node.js进程，生成一个核心文件。不能在Worker threads中调用。<h3 id="process-allowedNodeEnvironmentFlags"><a href="#process-allowedNodeEnvironmentFlags" class="headerlink" title="process.allowedNodeEnvironmentFlags"></a>process.allowedNodeEnvironmentFlags</h3></li>
</ul>
<p><strong>V10.10新增</strong>返回一个只读Set，包含允许的NODE_OPTIONS环境变量。</p>
<h3 id="process-chdir-directory"><a href="#process-chdir-directory" class="headerlink" title="process.chdir(directory)"></a>process.chdir(directory)</h3><p>更换当前目录</p>
<h3 id="process-stderr"><a href="#process-stderr" class="headerlink" title="process.stderr"></a>process.stderr</h3><p>返回一个链接到stderr（及fd为2）的流。除非fd 2指向一个文件（这时是可写流），否则它都是一个net.Socket（可读可写流）。</p>
<h3 id="process-stdin"><a href="#process-stdin" class="headerlink" title="process.stdin"></a>process.stdin</h3><p>返回一个链接到stdin（及fd为0）的流。除非fd 0指向一个文件（这时是可读流），否则它都是一个net.Socket（可读可写流）。</p>
<h3 id="process-stdout"><a href="#process-stdout" class="headerlink" title="process.stdout"></a>process.stdout</h3><p>返回一个链接到stdin（及fd为1）的流。除非fd 1指向一个文件（这时是可写流），否则它都是一个net.Socket（可读可写流）。</p>
<h3 id="process-stdout-and-process-stderr注意点"><a href="#process-stdout-and-process-stderr注意点" class="headerlink" title="process.stdout and process.stderr注意点"></a>process.stdout and process.stderr注意点</h3><ol>
<li>它们各自被console.log和console.error内部使用；</li>
<li>写操作可能是同步的，取决于流链接到的是什么，以及系统是windows还是POSIX<ul>
<li>文件：在windows和POSIX上都是同步的</li>
<li>TTYs：windows上异步，POSIX上同步</li>
<li>管道（以及socket）：windwos上同步，POSIX上异步</li>
</ul>
</li>
</ol>
<hr>
<h2 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a>Stream</h2><hr>
<h2 id="Trace-Events"><a href="#Trace-Events" class="headerlink" title="Trace Events"></a>Trace Events</h2><hr>
<h2 id="TTY"><a href="#TTY" class="headerlink" title="TTY"></a>TTY</h2><p>主要跟终端相关的操作。</p>
<hr>
<h2 id="V8"><a href="#V8" class="headerlink" title="V8"></a>V8</h2><p>V8模块包含内嵌在NodejsV8版本的二进制文件中的API。由引用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> v8 = <span class="built_in">require</span>(<span class="string">&#x27;v8&#x27;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="v8-cachedDataVersionTag"><a href="#v8-cachedDataVersionTag" class="headerlink" title="v8.cachedDataVersionTag()"></a>v8.cachedDataVersionTag()</h3><p>返回一个由v8版本、命令行标志和CPU特性决定的衍生值，为一个整数。主要用于判断 <strong>vm.Script cachedData buffer</strong> 是否与当前nodejs实例兼容。</p>
<h3 id="v8-getHeapSpaceStatistics"><a href="#v8-getHeapSpaceStatistics" class="headerlink" title="v8.getHeapSpaceStatistics()"></a>v8.getHeapSpaceStatistics()</h3><p>返回一个对象数组。代表了V8的堆空间的统计情况。</p>
<h3 id="v8-getHeapStatistics"><a href="#v8-getHeapStatistics" class="headerlink" title="v8.getHeapStatistics()"></a>v8.getHeapStatistics()</h3><p>返回堆统计。</p>
<h3 id="v8-setFlagsFromString-flags"><a href="#v8-setFlagsFromString-flags" class="headerlink" title="v8.setFlagsFromString(flags)"></a>v8.setFlagsFromString(flags)</h3><p>编程设置v8的命令行flag。使用起来得当心，VM已经启动后再去修改设置，可能引起不可预估的行为，比如崩溃或者数据丢失，或者该设置无效。</p>
<h3 id="Serialization-API"><a href="#Serialization-API" class="headerlink" title="Serialization API"></a>Serialization API</h3><p>处于实验阶段。</p>
<h4 id="v8-serialize-value"><a href="#v8-serialize-value" class="headerlink" title="v8.serialize(value)"></a>v8.serialize(value)</h4><p>value可为任意值。将value序列化为一个buffer对象。</p>
<h4 id="v8-deserialize-buffer"><a href="#v8-deserialize-buffer" class="headerlink" title="v8.deserialize(buffer)"></a>v8.deserialize(buffer)</h4><p>将buffer反序列化。buffer可为Buffer/TypedArray/DataView。</p>
<h3 id="v8-Serializer"><a href="#v8-Serializer" class="headerlink" title="v8.Serializer"></a>v8.Serializer</h3><h4 id="new-Serializer"><a href="#new-Serializer" class="headerlink" title="new Serializer()"></a>new Serializer()</h4><p>实例序列。</p>
<h4 id="serializer-writeHeader"><a href="#serializer-writeHeader" class="headerlink" title="serializer.writeHeader()"></a>serializer.writeHeader()</h4><p>写入头信息，包含格式版本等。</p>
<h4 id="serializer-writeValue-value"><a href="#serializer-writeValue-value" class="headerlink" title="serializer.writeValue(value)"></a>serializer.writeValue(value)</h4><p>写入值。</p>
<h4 id="serializer-releaseBuffer"><a href="#serializer-releaseBuffer" class="headerlink" title="serializer.releaseBuffer()"></a>serializer.releaseBuffer()</h4><p>返回Buffer。返回内部存储的buffer。当buffer被释放时，serializer就不能再使用了。如果先前写入失败，调用该方法结果不可知。</p>
<h4 id="serializer-transferArrayBuffer-id-arrayBuffer"><a href="#serializer-transferArrayBuffer-id-arrayBuffer" class="headerlink" title="serializer.transferArrayBuffer(id, arrayBuffer)"></a>serializer.transferArrayBuffer(id, arrayBuffer)</h4><h4 id="serializer-writeUint32-等"><a href="#serializer-writeUint32-等" class="headerlink" title="serializer.writeUint32 等"></a>serializer.writeUint32 等</h4><h3 id="v8-Deserializer-略"><a href="#v8-Deserializer-略" class="headerlink" title="v8.Deserializer 略"></a>v8.Deserializer 略</h3><hr>
<h2 id="VM"><a href="#VM" class="headerlink" title="VM"></a>VM</h2><p>vm模块提供API来编译(javascript本身是解释型语言，不需要传统意义的编译，此处的编译应该是转为可执行代码，理论上任何代码都需这一步)代码及运行在V8虚拟机环境中。vm不提供任何安全机制，不要使用它运行不可信的代码。<br>vm提供了一个类似沙盒的容器，内部的环境与主程序环境隔离。可以传递给vm一个环境对象，这个对象的键值将作为sandbox的global。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="built_in">require</span>(<span class="string">&#x27;vm&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> x = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> sandbox = &#123; <span class="attr">x</span>: <span class="number">2</span> &#125;;</span><br><span class="line">vm.createContext(sandbox); <span class="comment">// Contextify the sandbox.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> code = <span class="string">&#x27;x += 40; var y = 17;&#x27;</span>;</span><br><span class="line"><span class="comment">// `x` and `y` are global variables in the sandboxed environment.</span></span><br><span class="line"><span class="comment">// Initially, x has the value 2 because that is the value of sandbox.x.</span></span><br><span class="line">vm.runInContext(code, sandbox);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(sandbox.x); <span class="comment">// 42</span></span><br><span class="line"><span class="built_in">console</span>.log(sandbox.y); <span class="comment">// 17</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(x); <span class="comment">// 1; y is not defined.</span></span><br></pre></td></tr></table></figure>
<h3 id="Class-vm-Script"><a href="#Class-vm-Script" class="headerlink" title="Class: vm.Script"></a>Class: vm.Script</h3><p>vm.Script的实例包含了能直接在特定沙盒中运行的预编译代码。</p>
<h4 id="Constructor-new-vm-Script-code-options"><a href="#Constructor-new-vm-Script-code-options" class="headerlink" title="Constructor: new vm.Script(code[, options])"></a>Constructor: new vm.Script(code[, options])</h4><ul>
<li>code: 要预编译的代码</li>
<li>options: 对象或者字符串<ul>
<li>filename: 用于stack追踪。默认’evalmachine.<anonymous>‘</li>
<li>lineOffset: 指定行数的偏移。默认0</li>
<li>columnOffset</li>
<li>cachedData: <Buffer>|<TypedArray>|<DataView> </li>
<li>importModuleDynamically: 当import()被调用时回调。<h4 id="script-createCachedData"><a href="#script-createCachedData" class="headerlink" title="script.createCachedData()"></a>script.createCachedData()</h4>v10.6.0增加<br>创建代码的缓存，可用于Script的构造器中cachedData选项。</li>
</ul>
</li>
</ul>
<h4 id="script-runInContext-contextifiedSandbox-options"><a href="#script-runInContext-contextifiedSandbox-options" class="headerlink" title="script.runInContext(contextifiedSandbox[, options])"></a>script.runInContext(contextifiedSandbox[, options])</h4><ul>
<li>contextifiedSandbox: 一个通过vm.createContext(context)修改过的context对象</li>
<li>options: <ul>
<li>displayErrors: <Boolean></li>
<li>timeout: 超时时间。严格大于0的整数</li>
<li>breakOnSigint</li>
</ul>
</li>
<li>Returns: 返回最后一条语句的结果</li>
</ul>
<h4 id="script-runInNewContext-sandbox-options"><a href="#script-runInNewContext-sandbox-options" class="headerlink" title="script.runInNewContext([sandbox[, options]])"></a>script.runInNewContext([sandbox[, options]])</h4><ul>
<li>sandbox: 将被contextified的对象。<h4 id="script-runInThisContext-options"><a href="#script-runInThisContext-options" class="headerlink" title="script.runInThisContext([options])"></a>script.runInThisContext([options])</h4>运行在当前环境（主程序中）<h4 id="Timer等相关"><a href="#Timer等相关" class="headerlink" title="Timer等相关"></a>Timer等相关</h4>由于内部机制，process.nextTick、microtask、Promise等异步实现在v8和nodejs内，可能导致在某个环境中的代码逃离timeout。如下：<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="built_in">require</span>(<span class="string">&#x27;vm&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loop</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">while</span> (<span class="number">1</span>) <span class="built_in">console</span>.log(<span class="built_in">Date</span>.now());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vm.runInNewContext(</span><br><span class="line">  <span class="string">&#x27;Promise.resolve().then(loop);&#x27;</span>,</span><br><span class="line">  &#123; loop, <span class="built_in">console</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">timeout</span>: <span class="number">5</span> &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
即使设置了timeout，程序也会被无限死循环打印console.log，而不退出。（不存在是否有vm的参与，受timer的具体实现）。</li>
</ul>
<hr>
<h2 id="Zlib"><a href="#Zlib" class="headerlink" title="Zlib"></a>Zlib</h2><hr>
<h2 id="Worker-Threads"><a href="#Worker-Threads" class="headerlink" title="Worker Threads"></a>Worker Threads</h2><p>当前为试验阶段。工作线程为Nodejs添加了线程级的API。V10.5以后版本，开启需要加–experimental-worker选项。线程间通过channel通信。<br>Worker线程类似于HTML规范中的Worker，主要用于处理CPU密集型计算。不适合用作IO工作。<br>比起子进程、集群，worker线程能共享内存。能通过传递ArrayBuffer实例或者SharedArrayBuffer实例来共享数据。</p>
<h3 id="Worker-isMainThread"><a href="#Worker-isMainThread" class="headerlink" title="Worker.isMainThread"></a>Worker.isMainThread</h3><p><strong>v10.5.0新增</strong>，表示当前代码是否运行在Worker线程里。</p>
<h3 id="Worker-parentPort"><a href="#Worker-parentPort" class="headerlink" title="Worker.parentPort"></a>Worker.parentPort</h3><p><strong>v10.5.0新增</strong>，如果当前线程是worker线程，它指向父线程。</p>
<h3 id="Worker-threadId"><a href="#Worker-threadId" class="headerlink" title="Worker.threadId"></a>Worker.threadId</h3><p>当前线程ID。</p>
<h3 id="省略"><a href="#省略" class="headerlink" title="省略"></a>省略</h3><p>其它操作类似浏览器的worker。比如发送数据、监听事件等。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Nodejs/" rel="tag"># Nodejs</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2019/03/07/ng-nodejs%E5%81%B6%E5%8F%91502/" rel="prev" title="ng-nodejs偶发502">
                  <i class="fa fa-chevron-left"></i> ng-nodejs偶发502
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2019/03/27/GraphQL%E5%85%A5%E9%97%A8-%E4%BA%8C/" rel="next" title="GraphQL入门(1)">
                  GraphQL入门(1) <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="lv-container" data-id="city" data-uid="MTAyMC81MjY5OS8yOTE3Ng=="></div><script src="/js/comments.js"></script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class=""></i>
  </span>
  <span class="author" itemprop="copyrightHolder">谭智轩</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  




<script src="/js/third-party/comments/livere.js"></script>

</body>
</html>
